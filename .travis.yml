sudo: required
services:
- docker
install:
- docker build -t $BUILDING .
script:
- docker run -v $TRAVIS_BUILD_DIR/__tests__/mock:/var/www/__tests__/mock/:ro --rm
  -it $BUILDING npm test
after_success:
- docker login --username="$DOCKER_USERNAME" --password="$DOCKER_PASSWORD"
- |
  if [ -n "$TRAVIS_TAG" ]; then
    docker tag $BUILDING $DOCKER_IMAGE:$TRAVIS_TAG;
    docker push $DOCKER_IMAGE:$TRAVIS_TAG;
  fi
- |
  if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then
    docker tag $BUILDING $DOCKER_IMAGE:$TRAVIS_BRANCH;
    docker push $DOCKER_IMAGE:$TRAVIS_BRANCH;
  fi
env:
  global:
  - DOCKER_IMAGE=idigbio/idigbio-search-api
  - BUILDING=$DOCKER_IMAGE:$TRAVIS_COMMIT
  - secure: YKiua5KZjZ1djH756BCFhE+MAU+IHH+qZysluRCziBcUI4Eaa5J4KcbIAMHC6EU6hv0xtgZV2Bu6jQMe+16pPj+nvVbGYLc6ctr1zwwHEfZTRgLTyvUwlE/PQGFM7sIkAJ0m0JycIK6PrGqCIQJSfx5PmiMMBehUEAby4EOUbHY=
  - secure: eaCSyzhFtOo37BHnIXzrHj5nCKasSrZQCPjJ/9PchRj4ocquTizEiA50n+4BFyNpolmSjWXtb49Cd2wn6uxB+io740OBC2Fp6MxSKJ7hnh9Jan6VYnYeHyJFHQSVhPlWXkmGlPTe6aCq/AG55QZRt+4WFVDWoj5+WB04nOjtt1w=
notifications:
  slack:
    secure: hBdS1mIVFVg8jTQwU2nXKyfLRPbUMYCQK0g+NEjkSvWl3hvAnZREGo2JBFgincdB2/wAJhuynBQXN7MSwxGm4jTjvTrs1SOPP7hssTr+xFrXuOs9tYDNLICcUmc8iIkt9oblw/jWCKHUDnphmcZ4sy3uJDuxuKGHdBjXYAq/eZw=
